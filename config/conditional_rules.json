{
  "title": "Conditional Logic and Dependency Rules",
  "version": "1.0",
  "description": "Defines all conditional relationships between form fields",

  "dependency_rules": [
    {
      "rule_id": "R001",
      "name": "Permanent Address Different from Mailing",
      "trigger_field": "permanentAddressSameAsMailing",
      "trigger_value": false,
      "required_fields": [
        "permanentAddressLine1",
        "permanentCity",
        "permanentCountry"
      ],
      "optional_fields": [
        "permanentAddressLine2",
        "permanentZipCode"
      ]
    },
    {
      "rule_id": "R002",
      "name": "Utility Document Not in Applicant Name",
      "trigger_field": "utilityDocOption",
      "trigger_value": false,
      "required_fields": [
        "upload-authorization",
        "upload-person-id"
      ],
      "description": "When utility bill is not in applicant's name, authorization letter and ID of bill holder required"
    },
    {
      "rule_id": "R003",
      "name": "Employed Status Fields",
      "trigger_field": "employmentStatus",
      "trigger_values": ["FULL TIME PERMANENT", "FULL TIME TEMPORARY", "PART TIME"],
      "required_fields": [
        "employer",
        "occupation",
        "sector",
        "employmentType",
        "employerAddressLine1",
        "employerCity",
        "employerCountry",
        "workPhoneNo"
      ]
    },
    {
      "rule_id": "R004",
      "name": "Self Employed Fields",
      "trigger_field": "employmentStatus",
      "trigger_value": "SELF EMPLOYED",
      "required_fields": [
        "occupation",
        "sector"
      ],
      "excluded_fields": [
        "employer"
      ]
    },
    {
      "rule_id": "R005",
      "name": "Retired/Unemployed Fields",
      "trigger_field": "employmentStatus",
      "trigger_values": ["RETIRED NON PENSIONED", "RETIRED PENSIONED", "UNEMPLOYED", "OTHER"],
      "excluded_fields": [
        "employer",
        "employerAddressLine1",
        "employerAddressLine2",
        "employerCity",
        "employerCountry",
        "workPhoneNo"
      ]
    },
    {
      "rule_id": "R006",
      "name": "Beneficiary Section Activation",
      "trigger_field": "hasBeneficiary",
      "trigger_value": true,
      "activates_section": "beneficiary_details",
      "required_fields_per_instance": [
        "documentType",
        "beneficiaryMobileNo",
        "beneficiaryRelation",
        "upload-input"
      ]
    },
    {
      "rule_id": "R007",
      "name": "Joint Partner Section Activation",
      "trigger_field": "hasJointPartner",
      "trigger_value": true,
      "activates_section": "joint_partner_details",
      "required_fields_per_instance": [
        "customerId",
        "jointPartnerRelation",
        "jointPartnerDocumentType",
        "jp-upload-input"
      ]
    },
    {
      "rule_id": "R008",
      "name": "FIP Application Details",
      "trigger_field": "isApplyingForFipApplication",
      "trigger_value": true,
      "required_fields": [
        "fipPlan",
        "deductionTypeDesc"
      ],
      "activates_sections": [
        "fip_beneficiary"
      ]
    },
    {
      "rule_id": "R009",
      "name": "Group Health Insurance Details",
      "trigger_field": "groupHealth",
      "trigger_value": true,
      "required_fields": [
        "bank",
        "branchName",
        "accountNo",
        "accountType"
      ],
      "conditional_subsection": {
        "trigger_field": "isSpouseCoveredByOtherPlan",
        "trigger_value": true,
        "required_fields": [
          "planName",
          "insuranceCompany"
        ]
      }
    },
    {
      "rule_id": "R010",
      "name": "Dependent Section Activation",
      "trigger_field": "addDependent",
      "trigger_value": true,
      "repeatable": true,
      "required_fields_per_instance": [
        "dependent-{n}-isTecuMember",
        "dependent-{n}-documentType",
        "dependent-{n}-upload"
      ],
      "conditional_per_instance": {
        "trigger_field": "dependent-{n}-isTecuMember",
        "trigger_value": true,
        "required_fields": [
          "dependent-{n}-customerId"
        ]
      }
    },
    {
      "rule_id": "R011",
      "name": "Non-TT National Secondary Details",
      "trigger_field": "nationalOfTTSecondary",
      "trigger_value": false,
      "required_fields": [
        "countryOfResidence"
      ]
    },
    {
      "rule_id": "R012",
      "name": "ID Type Determines Upload Fields",
      "trigger_field": "primaryIdType",
      "conditions": [
        {
          "value": "Passport",
          "required_uploads": ["upload-front-input"]
        },
        {
          "value": "National Identification Card",
          "required_uploads": ["upload-front-input", "upload-back-input"]
        },
        {
          "value": "Driver's Permit",
          "required_uploads": ["upload-front-input", "upload-back-input"]
        }
      ]
    }
  ],

  "mutual_exclusions": [
    {
      "exclusion_id": "E001",
      "fields": ["FULL TIME PERMANENT", "SELF EMPLOYED", "UNEMPLOYED"],
      "description": "Employment status options are mutually exclusive"
    },
    {
      "exclusion_id": "E002",
      "fields": ["permanentAddressSameAsMailing_true", "permanentAddressSameAsMailing_false"],
      "description": "Boolean fields have mutually exclusive yes/no"
    }
  ],

  "repeatable_section_rules": {
    "beneficiary": {
      "min": 0,
      "max": 5,
      "trigger": "hasBeneficiary",
      "add_button": "Add Another Beneficiary",
      "index_pattern": "beneficiary-{n}",
      "percentage_rule": "All beneficiary percentages must sum to 100%"
    },
    "joint_partner": {
      "min": 0,
      "max": 3,
      "trigger": "hasJointPartner",
      "search_required": true,
      "search_field": "customerId"
    },
    "dependent": {
      "min": 0,
      "max": 10,
      "trigger": "addDependent",
      "index_pattern": "dependent-{n}",
      "has_tecu_member_variant": true
    },
    "fip_beneficiary": {
      "min": 1,
      "max": 5,
      "trigger": "isApplyingForFipApplication",
      "percentage_rule": "All FIP beneficiary percentages must sum to 100%"
    }
  },

  "validation_rules": {
    "percentage_fields": {
      "beneficiaryPercentage": {
        "min": 1,
        "max": 100,
        "sum_rule": "all_instances_sum_to_100"
      }
    },
    "phone_format": {
      "pattern": "XXX-XXXX",
      "regex": "^\\d{3}-\\d{4}$"
    },
    "email_format": {
      "regex": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
    },
    "customer_id": {
      "type": "numeric",
      "length": 6
    }
  },

  "page_navigation_rules": {
    "forward_only": false,
    "save_required_before_next": true,
    "otp_required_pages": ["contact_info", "pdf_other_details"],
    "page_order": [
      "contact_info",
      "documents",
      "additional_details",
      "other_products",
      "pep_fatca",
      "pdf_other_details"
    ]
  }
}
